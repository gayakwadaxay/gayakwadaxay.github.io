import{r as a,d as te,e as se,a as ae,b as re,f as m,g as ne,h as oe,j as s,D as ce,F as R,I as B,B as U}from"./index-C5bWfwtn.js";import{u as ie}from"./useCompanyGet-fIngaR75.js";import{l as le,v as ue,L as de}from"./react-simple-captcha-Do2OjeCW.js";const me=()=>{const[c,i]=a.useState(null),f=async o=>(await se.post("/visitor/login",o,{headers:{"Content-Type":"application/json"}})).data,{companyData:N,companyError:k,isCompanyLoading:x,isCompanyError:p,isCompanySuccess:g}=ie({token:c}),{mutate:T,data:u,error:b,isLoading:y,isError:j,isSuccess:n}=te(f,{onSuccess:o=>{var v;const w=(v=o==null?void 0:o.data)==null?void 0:v.jwt_token;i(w)}});return{mutate:T,data:u,error:b||k,isLoading:y||x,isError:j||p,isSuccess:n&&g,companyData:N}},xe=({numFields:c=6})=>{var V;const[i,f]=a.useState(Array(c).fill("")),[N,k]=a.useState(!0),[x,p]=a.useState(10),[g,T]=a.useState(""),[u,b]=a.useState(!1),[y,j]=a.useState(!1),n=a.useRef([]),o=a.useRef(),w=ae(),v=a.useRef(),z=a.useRef(),A=re(),[L,P]=a.useState(!1),[C,D]=a.useState(!1),[O,G]=a.useState(0);a.useEffect(()=>{le(4,"#000","#fff","upper")},[]);const{mutate:Z,data:H,error:M,isLoading:I,isError:$,isSuccess:q,companyData:K}=me(),_=a.useCallback(e=>{var t,r;(t=e==null?void 0:e.response)!=null&&t.token&&Z({token:(r=e==null?void 0:e.response)==null?void 0:r.token})},[]);a.useEffect(()=>{q&&(m.success("OTP Verified !"),A(ne(H.data.jwt_token)),A(oe(K.data)),w("/"))},[q,H,K]),a.useEffect(()=>{$&&m.error(M.message)},[$,M]);const h=a.useMemo(()=>new OTPless(_),[]);a.useEffect(()=>{var e;if(u){(e=n.current[0])==null||e.focus();let t=setInterval(()=>{p(r=>r-1)},1e3);return()=>{clearInterval(t)}}},[u]),a.useEffect(()=>{o!=null&&o.current&&o.current.focus()},[o]),a.useEffect(()=>{var e,t,r;(t=(e=n==null?void 0:n.current)==null?void 0:e[0])!=null&&t.current&&((r=n==null?void 0:n.current)==null||r[0].current.focus())},[(V=n==null?void 0:n.current)==null?void 0:V[0]]),a.useEffect(()=>{k(i.some(e=>e===""))},[i]);const J=(e,t)=>{var d;const{value:r}=t.target;if(/^[0-9]{1}$/.test(r)){const l=[...i];l[e]=r,f(l),e<c-1&&((d=n.current[e+1])==null||d.focus())}},Q=(e,t)=>{},W=(e,t)=>{var r,d,l,S;if(t.key==="Backspace"||t.key==="Delete"){const E=[...i];E[e]="",f(E),e>0&&((r=n.current[e-1])==null||r.focus())}else t.key==="ArrowRight"&&e<c-1?(d=n.current[e+1])==null||d.focus():t.key==="ArrowLeft"&&e>0?(l=n.current[e-1])==null||l.focus():/^[0-9]{1}$/.test(t.key)&&e<c-1&&t.target.value.length==1&&((S=n.current[e+1])==null||S.focus())},X=a.useCallback(e=>{e.preventDefault(),P(!0),G(t=>t+1),h.verify({channel:"PHONE",phone:g,otp:i.join(""),countryCode:"+91"}).then(({success:t})=>{t||(m.error("Request error: Incorrect OTP!"),P(!1))}).catch(t=>{m.error("Request error: Incorrect OTP!"),P(!1)})},[h,i]),Y=e=>{var r;e.preventDefault();const t=e.clipboardData.getData("text");if(new RegExp(`^[0-9]{${c}}$`).test(t)){const d=t.split(""),l=Array(c).fill("");d.forEach((S,E)=>{l[E]=S}),f(l),(r=n.current[c-1])==null||r.focus()}},F=a.useCallback(e=>{if(!C){if(D(!0),!ue(e.captcha)){m.error("CAPTCHA validation failed! Please try again."),setTimeout(()=>D(!1),500);return}e.mobile&&(T(e.mobile),h.initiate({channel:"PHONE",phone:e.mobile,countryCode:"+91"}),b(!0),p(120),j(!0),D(!1))}},[h]),ee=()=>{h.initiate({channel:"PHONE",phone:g,countryCode:"+91"}),b(!0),p(120),j(!0)};return a.useEffect(()=>{O>5&&m.error("Max retry limit reached !")},[O]),s.jsx(ce,{children:s.jsx("main",{className:"relative h-full flex flex-col justify-center bg-indigo-500 overflow-hidden px-4",children:s.jsxs("div",{className:"w-100 max-w-6xl mx-auto px-0 md:px-6 my-2 mb-12 md:py-24",children:[s.jsx("h1",{className:"text-4xl text-white pacifico-regular w-100 text-center my-5",children:"SafeGreet!"}),s.jsx("div",{className:"flex justify-center",children:s.jsxs("div",{className:"w-full mx-auto text-center bg-white px-4 sm:px-8 py-10 rounded-xl shadow",children:[s.jsxs("header",{className:"mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-indigo-500 mb-1",children:"Mobile verification step"}),s.jsx("p",{className:"text-[15px] text-slate-500 w-80",children:u?`Enter the ${c}-digit verification code that was sent to
                you.`:"Enter 10 digit mobile number, OTP will be sent on this number."})]}),u?s.jsxs("form",{onSubmit:X,ref:z,children:[s.jsx("div",{className:"flex items-center justify-center gap-3",children:i.map((e,t)=>s.jsx("input",{type:"number",className:"w-10 h-10 text-center text-md font-extrabold text-slate-900 bg-slate-300 border border-transparent hover:border-slate-200 appearance-none rounded p-2 outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100",maxLength:"1",value:e,ref:r=>n.current[t]=r,onChange:r=>J(t,r),onKeyDown:r=>W(t,r),onKeyUp:r=>Q(),onPaste:Y},t))}),s.jsx("div",{className:"max-w-[260px] mx-auto mt-4",children:s.jsx(U,{htmlType:"submit",className:"w-full inline-flex justify-center whitespace-nowrap rounded-lg px-3.5 py-2.5 text-sm font-medium shadow-sm shadow-indigo-950/10 transition-colors duration-150 ",disabled:N||I||L||O>5,loading:I,children:I||L?"Logging in...":"Verify Account"})})]}):s.jsxs(R,{onFinish:F,ref:v,tabIndex:0,children:[s.jsx(R.Item,{name:"mobile",rules:[{required:!0,message:"Please enter your mobile number!"},{pattern:/^[6-9]\d{9}$/,message:"Please enter a valid 10-digit mobile number!"}],children:s.jsx(B,{type:"number",maxLength:10,placeholder:"Enter your mobile number",className:"w-80 px-4 py-2 border rounded-md",ref:o})}),s.jsx(R.Item,{name:"captcha",className:"flex items-center justify-center",children:s.jsxs("div",{className:"captcha-wrapper w-80",children:[s.jsx(de,{}),s.jsx(B,{placeholder:"Enter the CAPTCHA",maxLength:4,className:"px-4 border rounded-md",pattern:"[a-zA-Z0-9]{4}",onInput:e=>{e.target.value=e.target.value.replace(/[^a-zA-Z0-9]/g,"").toUpperCase()}})]})}),s.jsx(U,{htmlType:"submit",className:"w-80 mt-4 bg-indigo-500 text-white py-2 px-2 rounded-lg",disabled:y||C,loading:C,children:y?"Resend Disabled":C?"Validating CAPTCHA":"Request OTP"})]}),u&&s.jsxs("div",{className:"text-sm text-slate-500 mt-4",children:["Didn't receive the code?",s.jsx("br",{}),x>0?s.jsxs("div",{className:"font-medium text-slate-400 text-sm",children:["Resend in ",x," seconds..."]}):s.jsx("a",{className:"font-medium text-indigo-500 hover:text-indigo-600",onClick:ee,children:"Resend code"})]})]})})]})})})};export{xe as default};
