import{d as W,e as X,r,a as Y,b as Z,f,g as F,j as s,D as ee,F as N,I as L,B as $}from"./index-C4xlPI3l.js";import{l as te,v as se,L as ae}from"./react-simple-captcha-GYBSW34D.js";const re=()=>{const o=async w=>(await X.post("/visitor/login",w,{headers:{"Content-Type":"application/json"}})).data,{mutate:c,data:u,error:y,isLoading:j,isError:p,isSuccess:h}=W(o);return{mutate:c,data:u,error:y,isLoading:j,isError:p,isSuccess:h}},ce=({numFields:o=6})=>{var A;const[c,u]=r.useState(Array(o).fill("")),[y,j]=r.useState(!0),[p,h]=r.useState(10),[w,E]=r.useState(""),[m,K]=r.useState(!1),[S,M]=r.useState(!1),n=r.useRef([]),d=r.useRef(),q=Y(),k=r.useRef(),H=r.useRef(),B=Z(),[C,U]=r.useState(!1);r.useState(""),r.useEffect(()=>{te(4,"#000","#fff","upper")},[]);const{mutate:P,data:T,error:D,isLoading:v,isError:O,isSuccess:I}=re(),R=r.useCallback(e=>{var t,a;(t=e==null?void 0:e.response)!=null&&t.token&&P({token:(a=e==null?void 0:e.response)==null?void 0:a.token})},[P]);r.useEffect(()=>{I&&(f.success("OTP Verified !"),B(F(T.data.jwt_token)),q("/"))},[I,T]),r.useEffect(()=>{O&&f.error(D.message)},[O,D]);const x=r.useMemo(()=>new OTPless(R),[R]);r.useEffect(()=>{var e;if(m){(e=n.current[0])==null||e.focus();let t=setInterval(()=>{h(a=>a-1)},1e3);return()=>{clearInterval(t)}}},[m]),r.useEffect(()=>{d!=null&&d.current&&d.current.focus()},[d]),r.useEffect(()=>{var e,t,a;(t=(e=n==null?void 0:n.current)==null?void 0:e[0])!=null&&t.current&&((a=n==null?void 0:n.current)==null||a[0].current.focus())},[(A=n==null?void 0:n.current)==null?void 0:A[0]]),r.useEffect(()=>{j(c.some(e=>e===""))},[c]);const V=(e,t)=>{var l;const{value:a}=t.target;if(/^[0-9]{1}$/.test(a)){const i=[...c];i[e]=a,u(i),e<o-1&&((l=n.current[e+1])==null||l.focus())}},G=(e,t)=>{},_=(e,t)=>{var a,l,i,b;if(t.key==="Backspace"||t.key==="Delete"){const g=[...c];g[e]="",u(g),e>0&&((a=n.current[e-1])==null||a.focus())}else t.key==="ArrowRight"&&e<o-1?(l=n.current[e+1])==null||l.focus():t.key==="ArrowLeft"&&e>0?(i=n.current[e-1])==null||i.focus():/^[0-9]{1}$/.test(t.key)&&e<o-1&&t.target.value.length==1&&((b=n.current[e+1])==null||b.focus())},z=r.useCallback(e=>{e.preventDefault(),U(!0),x.verify({channel:"PHONE",phone:w,otp:c.join(""),countryCode:"+91"}).then(({success:t})=>{t||f.error("Request error: Incorrect OTP!")}).catch(t=>{f.error("Request error: Incorrect OTP!")})},[x,c]),J=e=>{var a;e.preventDefault();const t=e.clipboardData.getData("text");if(new RegExp(`^[0-9]{${o}}$`).test(t)){const l=t.split(""),i=Array(o).fill("");l.forEach((b,g)=>{i[g]=b}),u(i),(a=n.current[o-1])==null||a.focus()}},Q=r.useCallback(e=>{if(!se(e.captcha)){f.error("CAPTCHA validation failed! Please try again.");return}e.mobile&&(E(e.mobile),x.initiate({channel:"PHONE",phone:e.mobile,countryCode:"+91"}),K(!0),h(120),M(!0))},[x]);return s.jsx(ee,{children:s.jsx("main",{className:"relative h-full flex flex-col justify-center bg-indigo-500 overflow-hidden px-4",children:s.jsxs("div",{className:"w-100 max-w-6xl mx-auto px-0 md:px-6 my-2 mb-12 md:py-24",children:[s.jsx("h1",{className:"text-4xl text-white pacifico-regular w-100 text-center my-5",children:"SafeGreet!"}),s.jsx("div",{className:"flex justify-center",children:s.jsxs("div",{className:"w-full mx-auto text-center bg-white px-4 sm:px-8 py-10 rounded-xl shadow",children:[s.jsxs("header",{className:"mb-8",children:[s.jsx("h1",{className:"text-2xl font-bold text-indigo-500 mb-1",children:"Mobile verification step"}),s.jsx("p",{className:"text-[15px] text-slate-500 w-80",children:m?`Enter the ${o}-digit verification code that was sent to
                you.`:"Enter 10 digit mobile number, OTP will be sent on this number."})]}),m?s.jsxs("form",{onSubmit:z,ref:H,children:[s.jsx("div",{className:"flex items-center justify-center gap-3",children:c.map((e,t)=>s.jsx("input",{type:"number",className:"w-10 h-10 text-center text-md font-extrabold text-slate-900 bg-slate-300 border border-transparent hover:border-slate-200 appearance-none rounded p-2 outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100",maxLength:"1",value:e,ref:a=>n.current[t]=a,onChange:a=>V(t,a),onKeyDown:a=>_(t,a),onKeyUp:a=>G(),onPaste:J},t))}),s.jsx("div",{className:"max-w-[260px] mx-auto mt-4",children:s.jsx($,{htmlType:"submit",className:"w-full inline-flex justify-center whitespace-nowrap rounded-lg px-3.5 py-2.5 text-sm font-medium shadow-sm shadow-indigo-950/10 transition-colors duration-150 ",disabled:y||v||C,loading:v,children:v||C?"Logging in...":"Verify Account"})})]}):s.jsxs(N,{onFinish:Q,ref:k,tabIndex:0,onKeyUp:e=>{e.keyCode===13&&k.current.submit()},children:[s.jsx(N.Item,{name:"mobile",rules:[{required:!0,message:"Please enter your mobile number!"},{pattern:/^[6-9]\d{9}$/,message:"Please enter a valid 10-digit mobile number!"}],children:s.jsx(L,{type:"number",maxLength:10,placeholder:"Enter your mobile number",className:"w-80 px-4 py-2 border rounded-md",ref:d})}),s.jsx(N.Item,{name:"captcha",className:"flex items-center justify-center",children:s.jsxs("div",{className:"captcha-wrapper w-80",children:[s.jsx(ae,{}),s.jsx(L,{placeholder:"Enter the CAPTCHA",className:"px-4 border rounded-md "})]})}),s.jsx($,{htmlType:"submit",className:"w-80 mt-4 bg-indigo-500 text-white py-2 px-2 rounded-lg",disabled:S,children:S?"Resend Disabled":"Request OTP"})]}),m&&s.jsxs("div",{className:"text-sm text-slate-500 mt-4",children:["Didn't receive the code?",s.jsx("br",{}),p>0?s.jsxs("div",{className:"font-medium text-slate-400 text-sm",children:["Resend in ",p," seconds..."]}):s.jsx("a",{className:"font-medium text-indigo-500 hover:text-indigo-600",onClick:phoneAuth,children:"Resend code"})]})]})})]})})})};export{ce as default};
